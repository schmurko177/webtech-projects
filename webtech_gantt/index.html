<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gantt Project Planner</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>
<body>
<div id="app" v-cloak>
    <!-- Header -->
    <header class="app-header">
        <div class="header-main">
            <h1 class="app-title">{{ t('app_title') }}</h1>
            <div class="header-controls">
                <div class="control-group">
                    <label>{{ t('language') }}</label>
                    <select v-model="ui.lang" @change="saveUI">
                        <option value="sk">SK</option>
                        <option value="en">EN</option>
                    </select>
                </div>
                <div class="control-group">
                    <label>{{ t('theme') }}</label>
                    <button @click="toggleTheme" class="theme-toggle">
                        {{ ui.theme === 'light' ? 'üåô' : '‚òÄÔ∏è' }}
                    </button>
                </div>
                <div class="control-group">
                    <label>{{ t('zoom') }}</label>
                    <select v-model="ui.zoom" @change="saveUI">
                        <option value="day">{{ t('day') }}</option>
                        <option value="week">{{ t('week') }}</option>
                        <option value="month">{{ t('month') }}</option>
                        <option value="quarter">{{ t('quarter') }}</option>
                    </select>
                </div>
                <div class="control-group">
                    <button @click="scrollToToday" class="btn btn-secondary" :title="t('scroll_to_today')">
                        üìç {{ t('today') }}
                    </button>
                </div>
            </div>
        </div>
        <div class="header-info">
            <span class="current-date">{{ t('today_is') }}: {{ currentDate }}</span>
        </div>
    </header>

    <!-- Main Content -->
    <main class="app-main">
        <!-- Sidebar -->
        <aside class="sidebar">
            <!-- Date Range -->
            <section class="sidebar-section">
                <h3>{{ t('date_range') }}</h3>
                <div class="form-group">
                    <label>{{ t('start_date') }}</label>
                    <input type="date" v-model="settings.startDate" @change="saveSettings">
                </div>
                <div class="form-group">
                    <label>{{ t('end_date') }}</label>
                    <input type="date" v-model="settings.endDate" @change="saveSettings">
                </div>
            </section>

            <!-- Task Form -->
            <section class="sidebar-section">
                <h3>{{ editingTask ? t('edit_task') : t('add_task') }}</h3>
                <div class="form-group">
                    <label>{{ t('task_name') }}</label>
                    <input type="text" v-model="taskForm.name" :placeholder="t('task_name_placeholder')">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>{{ t('start_date') }}</label>
                        <input type="date" v-model="taskForm.start">
                    </div>
                    <div class="form-group">
                        <label>{{ t('end_date') }}</label>
                        <input type="date" v-model="taskForm.end">
                    </div>
                </div>
                <div class="form-group">
                    <label>{{ t('progress') }}</label>
                    <input type="range" v-model.number="taskForm.progress" min="0" max="100">
                    <span>{{ taskForm.progress }}%</span>
                </div>
                <div class="form-group">
                    <label>{{ t('color') }}</label>
                    <input type="color" v-model="taskForm.color">
                </div>
                <div class="form-group">
                    <label>{{ t('tags') }}</label>
                    <input type="text" v-model="taskForm.tags" :placeholder="t('tags_placeholder')">
                </div>
                <div class="form-actions">
                    <button @click="saveTask" class="btn btn-primary">
                        {{ editingTask ? t('update') : t('add') }}
                    </button>
                    <button @click="cancelEdit" class="btn btn-secondary" v-if="editingTask">
                        {{ t('cancel') }}
                    </button>
                    <button @click="clearForm" class="btn btn-secondary">
                        {{ t('clear') }}
                    </button>
                </div>
            </section>

            <!-- Search & Filter -->
            <section class="sidebar-section">
                <h3>{{ t('search_filter') }}</h3>
                <div class="form-group">
                    <label>{{ t('search') }}</label>
                    <input type="text" v-model="filters.search" :placeholder="t('search_placeholder')">
                </div>
                <div class="form-group">
                    <label>{{ t('filter_by_tag') }}</label>
                    <select v-model="filters.tag">
                        <option value="">{{ t('all_tags') }}</option>
                        <option v-for="tag in allTags" :value="tag">{{ tag }}</option>
                    </select>
                </div>
            </section>

            <!-- Import/Export -->
            <section class="sidebar-section">
                <h3>{{ t('import_export') }}</h3>
                <div class="form-actions">
                    <button @click="exportData" class="btn btn-primary">{{ t('export') }}</button>
                    <button @click="importData" class="btn btn-secondary">{{ t('import') }}</button>
                    <input type="file" ref="importFile" @change="handleImport" accept=".json" style="display: none;">
                </div>
            </section>

            <!-- Legend -->
            <section class="sidebar-section">
                <h3>{{ t('legend') }}</h3>
                <div class="legend-list">
                    <div v-for="(item, index) in legend" :key="item.id" class="legend-item">
                        <input type="color" v-model="item.color" @change="saveLegend">
                        <input type="text" v-model="item.label" @blur="saveLegend"
                               :placeholder="t('legend_placeholder')">
                        <button @click="removeLegendItem(index)" class="btn-remove">√ó</button>
                    </div>
                    <button @click="addLegendItem" class="btn-add">{{ t('add_category') }}</button>
                </div>
            </section>
        </aside>

        <!-- NEW: Tasks Container for task names -->
        <section class="tasks-container">
            <div class="tasks-header"> <!-- –∑–∞–≥–æ–ª–æ–≤–æ–∫ –¥–ª—è –≤–∏—Ä—ñ–≤–Ω—é–≤–∞–Ω–Ω—è –∑ timeline -->
                <div class="task-header-placeholder">{{ t('tasks') }}</div>
            </div>
            <div class="tasks-list">
                <div v-for="task in filteredTasks" :key="task.id"
                     class="task-row"
                     :class="{ 'task-row--highlight': isTaskHighlighted(task) }">

                    <div class="task-info">
                        <div class="task-name" contenteditable="true"
                             @blur="updateTaskProperty(task, 'name', $event)"
                             @keydown.enter="$event.target.blur()">
                            {{ task.name }}
                        </div>
                        <div class="task-dates">
                        <span contenteditable="true"
                              @blur="updateTaskProperty(task, 'start', $event)"
                              @keydown.enter="$event.target.blur()">
                            {{ formatDate(task.start) }}
                        </span>
                            -
                            <span contenteditable="true"
                                  @blur="updateTaskProperty(task, 'end', $event)"
                                  @keydown.enter="$event.target.blur()">
                            {{ formatDate(task.end) }}
                        </span>
                        </div>
                        <div class="task-tags">
                        <span v-for="tag in task.tags" :key="tag" class="task-tag">
                            {{ tag }}
                        </span>
                        </div>
                    </div>

                    <div class="task-actions">
                        <button @click="editTask(task)" class="btn-icon" :title="t('edit')">‚úé</button>
                        <button @click="deleteTask(task.id)" class="btn-icon" :title="t('delete')">√ó</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Gantt Chart - —Ç—ñ–ª—å–∫–∏ timeline + –±–∞—Ä–∏ -->
        <section class="gantt-container">
            <!-- Timeline Header -->
            <div class="timeline-header" ref="timelineHeader" @scroll="syncScroll">
                <div class="timeline-header-inner" :style="timelineGridStyles">
                    <div v-for="cell in timelineCells"
                         :key="cell.key"
                         class="timeline-cell"
                         :class="{ 'timeline-cell--today': cell.isToday }"
                         :title="cell.isToday ? t('today') : ''">
                        {{ cell.label }}
                        <span v-if="cell.isToday" class="today-indicator">‚óè</span>
                    </div>
                </div>
            </div>

            <!-- Gantt Body - —Ç—ñ–ª—å–∫–∏ –±–∞—Ä–∏ –∑–∞–≤–¥–∞–Ω—å -->
            <div class="gantt-body" ref="ganttBody" @scroll="syncScroll">
                <div class="gantt-body-inner" :style="timelineGridStyles">
                    <div v-for="task in filteredTasks" :key="task.id"
                         class="gantt-row"
                         :class="{ 'gantt-row--highlight': isTaskHighlighted(task) }">

                        <!-- Task Bar Area -->
                        <div class="task-timeline">
                            <div class="task-bar-container">
                                <div class="task-bar"
                                     :style="getTaskBarStyle(task)"
                                     draggable="true"
                                     @dragstart="onDragStart(task.id)"
                                     @dragover.prevent="onDragOver(task.id)"
                                     @drop="onDrop(task.id)">

                                    <div class="task-progress" :style="{ width: task.progress + '%' }"></div>

                                    <div class="task-bar-content">
                                    <span class="task-bar-name"
                                          contenteditable="true"
                                          @blur="updateTaskProperty(task, 'name', $event)"
                                          @keydown.enter="$event.target.blur()">
                                        {{ task.name }}
                                    </span>
                                        <span class="task-bar-progress"
                                              contenteditable="true"
                                              @blur="updateTaskProperty(task, 'progress', $event, true)"
                                              @keydown.enter="$event.target.blur()">
                                        {{ task.progress }}%
                                    </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Print Button -->
    <div class="print-controls">
        <label>
            <input type="checkbox" v-model="ui.printShowDate">
            {{ t('show_date_print') }}
        </label>
        <button @click="printChart" class="btn btn-primary">{{ t('print') }}</button>
    </div>
</div>

<script src="js/app.js"></script>
</body>
</html>